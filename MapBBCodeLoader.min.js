window.mapBBCodeLoaderOptions={path:"mapbbcode/",language:"",addons:[],proprietary:[],plain:!1,mapBBCodeOptions:{},processorOptions:{},set:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t])}},function(e,t){function n(e,n,a){var o,r,s,i=[],d=e||t,l=new RegExp("(?:^|\\s)"+n+"(?:\\s|$)");if(e.className&&l.test(e.className))return[e];if(d.getElementsByClassName)for(s=d.getElementsByClassName(n),o=0;o<s.length;o++)for(r=0;r<a.length;r++)s[o].nodeName==a[r]&&i.push(s[o]);else{for(s=[],o=0;o<a.length;o++)s=s.concat(d.getElementsByTagName(a[o]));for(o=0;o<s.length;o++)l.test(s[o].className)&&i.push(s[o])}return i}function a(e){var n=[];return function a(e){if(e.childNodes.length)for(var t=0;t<e.childNodes.length;t++)"tagName"in e&&"TEXTAREA"==e.tagName||"className"in e&&!(e.className.indexOf("mapbbcode")<0)||a(e.childNodes[t]);else e.nodeType==Node.TEXT_NODE&&(e.nodeValue.indexOf("[/map]")>=0||e.nodeValue.indexOf("[mapid]")>=0)&&n.push(e)}(e||t),n}function o(e,n,a,o){var r=t.createElement("div"),s=e.splitText(n),i=s.splitText(a);return r.className=o,s.parentNode.insertBefore(r,s),r.appendChild(s),i}function r(t){for(var n=new RegExp(e.MapBBCodeProcessor.getBBCodeRegExp().source,"gi"),a=new RegExp("\\[mapid\\]\\s*[a-z]+\\s*\\[/mapid\\]","gi"),r=0;r<t.length;r++)for(var s,i,d=t[r];;)if(s=n.exec(d.nodeValue),i=a.exec(d.nodeValue),s&&s.length>0)e.MapBBCodeProcessor.isEmpty(s[0])||(d=o(d,s.index,s[0].length,"mapbbcode"),n.lastIndex=0,a.lastIndex=0);else{if(!(i&&i.length>0))break;d=o(d,i.index,i[0].length,"mapbbcode_shared"),n.lastIndex=0,a.lastIndex=0}}function s(o,s){if(e.mapBBCodeLoaderOptions.plain){var i=a(o);i.length>0&&("MapBBCodeProcessor"in e?r(i):s.call(this,{}))}var d,l,p,c=n(o,"mapbbcode",["DIV"]);for(d=0;d<c.length;d++)if(l=c[d].childNodes,!(l&&l.length>0&&("DIV"==l[0].tagName||l.length>1&&"DIV"==l[1].tagName))&&(p=s.call(this,{shared:!1,element:c[d]})))return;for(c=n(o,"mapbbcode_shared",["DIV"]),d=0;d<c.length;d++)if(l=c[d].childNodes,!(l&&l.length>0&&("DIV"==l[0].tagName||l.length>1&&"DIV"==l[1].tagName))){var g=/^\s*(?:\[mapid\]\s*)?([a-z]+)(?:\s*\[\/mapid\])?\s*$/.exec(c[d].innerHTML);if(g&&g.length>1&&(p=s.call(this,{shared:!0,id:g[1],element:c[d]})))return}for(buttons=n(o,"mapbbcode_edit",["INPUT","BUTTON"]),d=0;d<buttons.length;d++){var h;if(buttons[d].getAttribute("target_id")&&(h=t.getElementsById(buttons[d].getAttribute("target_id"))),!h){var u=t.getElementsByTagName("TEXTAREA");u&&u.length>0&&(h=u[0])}if(p=s.call(this,{button:!0,target:h,element:buttons[d]}))return}}function i(e,t){if(!e||!e.length)return e;if(e=e.replace(/^\s+|\s+$/g,"").replace(/\.js$/,""),e.length<=1)return e.toUpperCase();if(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),t){var n=e.substring(0,2);"En"==n?e="English":"Ru"==n&&(e="Russian")}return e}function d(e,n){var a,o=t.head||t.getElementsByTagName("head")[0];if("css"==e.substring(e.length-3))a=t.createElement("link"),a.rel="stylesheet",a.type="text/css",a.href=e;else{a=t.createElement("script"),a.type="text/javascript",a.async=!0,a.src=e;var r=!1;a.onload=a.onreadystatechange=a.onerror=function(){r||a.readyState&&!/loaded|complete/.test(a.readyState)||(r=!0,a.onload=a.onreadystatechange=null,u--,n&&n())},u++}o.appendChild(a)}function l(){var n=!1;if(s(t,function(){return n=!0,!0}),n){if(f||"MapBBCode"in e)return"updateMapBBCode"in e&&e.updateMapBBCode(),void 0;f=!0;var a=e.mapBBCodeLoaderOptions,o=a.path||".";"/"!==o.substring(o.length-1)&&(o+="/"),"windowPath"in a.mapBBCodeOptions||(a.mapBBCodeOptions.windowPath=o),d(o+"leaflet.css"),"ActiveXObject"in e&&!t.addEventListener&&d(o+"leaflet.ie.css"),d(o+"leaflet.js",function(){d(o+"mapbbcode.js",function(){var t,n=i(a.language,!0);if(n&&n.length>1&&d(o+"lang/"+n+".js"),a.proprietary.length>0||a.mapBBCodeOptions.layers)for(d(o+"LayerList.js"),t=0;t<a.proprietary.length;t++)d(o+"proprietary/"+i(a.proprietary[t])+".js");for(t=0;t<a.addons.length;t++)d(o+a.addons[t]);h=e.setInterval(g,50)})})}}function p(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function c(n){s(n||t,function(t){var n=e._mapBBCode;t.button?p(t.element,"click",function(){n.editorWindow(t.target)}):t.shared?n.showExternal(t.element,t.id):n.show(t.element)})}function g(){if(!(u>0&&--m>0)){e.clearInterval(h);var t=e.mapBBCodeLoaderOptions;e.MapBBCodeProcessor.setOptions(t.processorOptions),e._mapBBCode=new e.MapBBCode(t.mapBBCodeOptions),e.updateMapBBCode=c,c()}}var h,u=0,m=60,f=!1;if("interactive"==t.readyState||"complete"==t.readyState)l();else if(t.addEventListener)t.addEventListener("DOMContentLoaded",l,!1);else{var B=function(){"interactive"!=t.readyState&&"complete"!=t.readyState?setTimeout(B,50):l()};B()}}(window,document);