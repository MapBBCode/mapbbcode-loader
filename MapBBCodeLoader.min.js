window.mapBBCodeLoaderOptions = {
    path: "mapbbcode/",
    language: "",
    addons: [],
    proprietary: [],
    plain: false,
    force: false,
    draw: false,
    mapBBCodeOptions: {},
    processorOptions: {}
};window.mapBBCodeLoaderOptions.set=function(e){for(var t in e)if("mapBBCodeOptions"===t){var a,n=e[t];for(a in n)n.hasOwnProperty(a)&&(this[t][a]=n[a])}else e.hasOwnProperty(t)&&(this[t]=e[t])},function(e,t){function a(e,a,n){var r,o,s,i=[],d=e||t,l=new RegExp("(?:^|\\s)"+a+"(?:\\s|$)");if(e.className&&l.test(e.className))return[e];if(d.getElementsByClassName)for(s=d.getElementsByClassName(a),r=0;r<s.length;r++)for(o=0;o<n.length;o++)s[r].nodeName==n[o]&&i.push(s[r]);else{for(s=[],r=0;r<n.length;r++)s=s.concat(d.getElementsByTagName(n[r]));for(r=0;r<s.length;r++)l.test(s[r].className)&&i.push(s[r])}return i}function n(e){var a=[];return function n(e){if(e.childNodes.length)for(var t=0;t<e.childNodes.length;t++)"tagName"in e&&"TEXTAREA"==e.tagName||"className"in e&&!(e.className.indexOf("mapbbcode")<0)||n(e.childNodes[t]);else e.nodeType==Node.TEXT_NODE&&(e.nodeValue.indexOf("[/map]")>=0||e.nodeValue.indexOf("[mapid]")>=0)&&a.push(e)}(e||t),a}function r(e,a,n,r){var o=t.createElement("div"),s=e.splitText(a),i=s.splitText(n);return o.className=r,s.parentNode.insertBefore(o,s),o.appendChild(s),i}function o(t){for(var a=new RegExp(e.MapBBCodeProcessor.getBBCodeRegExp().source,"gi"),n=new RegExp("\\[mapid\\]\\s*[a-z]+\\s*\\[/mapid\\]","gi"),o=0;o<t.length;o++)for(var s,i,d=t[o];;)if(s=a.exec(d.nodeValue),i=n.exec(d.nodeValue),s&&s.length>0)e.MapBBCodeProcessor.isEmpty(s[0])||(d=r(d,s.index,s[0].length,"mapbbcode"),a.lastIndex=0,n.lastIndex=0);else{if(!(i&&i.length>0))break;d=r(d,i.index,i[0].length,"mapbbcode_shared"),a.lastIndex=0,n.lastIndex=0}}function s(r,s){if(e.mapBBCodeLoaderOptions.plain){var i=n(r);i.length>0&&("MapBBCodeProcessor"in e?o(i):s.call(this,{}))}var d,l,p,c=a(r,"mapbbcode",["DIV"]);for(d=0;d<c.length;d++)if(l=c[d].childNodes,!(l&&l.length>0&&("DIV"==l[0].tagName||l.length>1&&"DIV"==l[1].tagName))&&(p=s.call(this,{shared:!1,element:c[d]})))return;for(c=a(r,"mapbbcode_shared",["DIV"]),d=0;d<c.length;d++)if(l=c[d].childNodes,!(l&&l.length>0&&("DIV"==l[0].tagName||l.length>1&&"DIV"==l[1].tagName))){var f=/^\s*(?:\[mapid\]\s*)?([a-z]+)(?:\s*\[\/mapid\])?\s*$/.exec(c[d].innerHTML);if(f&&f.length>1&&(p=s.call(this,{shared:!0,id:f[1],element:c[d]})))return}for(buttons=a(r,"mapbbcode_edit",["INPUT","BUTTON"]),d=0;d<buttons.length;d++){var g;if(buttons[d].getAttribute("target_id")&&(g=t.getElementsById(buttons[d].getAttribute("target_id"))),!g){var h=t.getElementsByTagName("TEXTAREA");h&&h.length>0&&(g=h[0])}if(p=s.call(this,{button:!0,target:g,element:buttons[d]}))return}}function i(e,t){if(!e||!e.length)return e;if(e=e.replace(/^\s+|\s+$/g,"").replace(/\.js$/,""),e.length<=1)return e.toUpperCase();if(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),t){var a=e.substring(0,2);"En"==a?e="English":"Ru"==a&&(e="Russian")}return e}function d(e,a){var n,r=t.head||t.getElementsByTagName("head")[0];if("css"==e.substring(e.length-3))n=t.createElement("link"),n.rel="stylesheet",n.type="text/css",n.href=e;else{n=t.createElement("script"),n.type="text/javascript",n.async=!0,n.src=e;var o=!1;n.onload=n.onreadystatechange=n.onerror=function(){o||n.readyState&&!/loaded|complete/.test(n.readyState)||(o=!0,n.onload=n.onreadystatechange=null,h--,a&&a())},h++}r.appendChild(n)}function l(){if(m||"MapBBCode"in e)return"updateMapBBCode"in e&&e.updateMapBBCode(),void 0;m=!0;var a=e.mapBBCodeLoaderOptions;if(!a.force){var n=!1;if(s(t,function(){return n=!0,!0}),!n)return}var r=a.path||".";"/"!==r.substring(r.length-1)&&(r+="/"),"windowPath"in a.mapBBCodeOptions||(a.mapBBCodeOptions.windowPath=r),d(r+"leaflet.css"),"ActiveXObject"in e&&!t.addEventListener&&d(r+"leaflet.ie.css"),d(r+"leaflet.js",function(){a.draw&&(d(r+"leaflet.draw.css"),d(r+"leaflet.draw.js")),d(r+"mapbbcode.js",function(){var t,n=i(a.language,!0);if(n&&n.length>1&&d(r+"lang/"+n+".js"),a.proprietary.length>0||a.mapBBCodeOptions.layers)for(d(r+"LayerList.js"),t=0;t<a.proprietary.length;t++)d(r+"proprietary/"+i(a.proprietary[t])+".js");for(t=0;t<a.addons.length;t++)d(r+a.addons[t]);g=e.setInterval(f,50)})})}function p(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent&&e.attachEvent("on"+t,a)}function c(a){s(a||t,function(t){var a=e._mapBBCode;t.button?p(t.element,"click",function(){a.editorWindow(t.target)}):t.shared?a.showExternal(t.element,t.id):a.show(t.element)})}function f(){if(!(h>0&&--u>0)){e.clearInterval(g);var t=e.mapBBCodeLoaderOptions;e.MapBBCodeProcessor.setOptions(t.processorOptions),e._mapBBCode=new e.MapBBCode(t.mapBBCodeOptions),e.updateMapBBCode=c,c(),t.onload&&t.onload(e._mapBBCode)}}var g,h=0,u=60,m=!1;if("interactive"==t.readyState||"complete"==t.readyState)l();else if(t.addEventListener)t.addEventListener("DOMContentLoaded",l,!1);else{var B=function(){"interactive"!=t.readyState&&"complete"!=t.readyState?setTimeout(B,50):l()};B()}}(window,document);