window.mapBBCodeLoaderOptions={path:"mapbbcode/",language:"",addons:[],proprietary:[],plain:!1,mapBBCodeOptions:{},processorOptions:{},set:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t])}},function(e,t){function n(e,n,a){var s,r,o,i=[],l=e||t,d=new RegExp("(?:^|\\s)"+n+"(?:\\s|$)");if(e.className&&d.test(e.className))return[e];if(l.getElementsByClassName)for(o=l.getElementsByClassName(n),s=0;s<o.length;s++)for(r=0;r<a.length;r++)o[s].nodeName==a[r]&&i.push(o[s]);else{for(o=[],s=0;s<a.length;s++)o=o.concat(l.getElementsByTagName(a[s]));for(s=0;s<o.length;s++)d.test(o[s].className)&&i.push(o[s])}return i}function a(e){var n=[];return function a(e){if(e.childNodes.length)for(var t=0;t<e.childNodes.length;t++)"tagName"in e&&"TEXTAREA"==e.tagName||"className"in e&&!(e.className.indexOf("mapbbcode")<0)||a(e.childNodes[t]);else e.nodeType==Node.TEXT_NODE&&(e.nodeValue.indexOf("[/map]")>=0||e.nodeValue.indexOf("[mapid]")>=0)&&n.push(e)}(e||t),n}function s(e,n,a,s){var r=t.createElement("div"),o=e.splitText(n),i=o.splitText(a);return r.className=s,o.parentNode.insertBefore(r,o),r.appendChild(o),i}function r(t){var n=a(t);if(n.length>0)for(var r=new RegExp(e.MapBBCodeProcessor.getBBCodeRegExp().source,"gi"),o=new RegExp("\\[mapid\\]\\s*[a-z]+\\s*\\[/mapid\\]","gi"),i=0;i<n.length;i++)for(var l,d,p=n[i];;)if(l=r.exec(p.nodeValue),d=o.exec(p.nodeValue),l&&l.length>0)e.MapBBCodeProcessor.isEmpty(l[0])||(p=s(p,l.index,l[0].length,"mapbbcode"),r.lastIndex=0,o.lastIndex=0);else{if(!(d&&d.length>0))break;p=s(p,d.index,d[0].length,"mapbbcode_shared"),r.lastIndex=0,o.lastIndex=0}}function o(s,o){if(e.mapBBCodeLoaderOptions.plain)if("MapBBCodeProcessor"in e)r(s);else{var i=a(s);i.length>0&&o.call(this,{})}var l,d,p,c=n(s,"mapbbcode",["DIV"]);for(l=0;l<c.length;l++)if(d=c[l].childNodes,!(d&&d.length>0&&("DIV"==d[0].tagName||d.length>1&&"DIV"==d[1].tagName))&&(p=o.call(this,{shared:!1,element:c[l]})))return;for(c=n(s,"mapbbcode_shared",["DIV"]),l=0;l<c.length;l++)if(d=c[l].childNodes,!(d&&d.length>0&&("DIV"==d[0].tagName||d.length>1&&"DIV"==d[1].tagName))){var g=/^\s*(?:\[mapid\]\s*)?([a-z]+)(?:\s*\[\/mapid\])?\s*$/.exec(c[l].innerHTML);if(g&&g.length>1&&(p=o.call(this,{shared:!0,id:g[1],element:c[l]})))return}for(buttons=n(s,"mapbbcode_edit",["INPUT","BUTTON"]),l=0;l<buttons.length;l++){var h;if(buttons[l].getAttribute("target_id")&&(h=t.getElementsById(buttons[l].getAttribute("target_id"))),!h){var m=t.getElementsByTagName("TEXTAREA");m&&m.length>0&&(h=m[0])}if(p=o.call(this,{button:!0,target:h,element:buttons[l]}))return}}function i(e,t){if(!e||!e.length)return e;if(e=e.replace(/^\s+|\s+$/g,"").replace(/\.js$/,""),e.length<=1)return e.toUpperCase();if(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),t){var n=e.substring(0,2);"En"==n?e="English":"Ru"==n&&(e="Russian")}return e}function l(e,n){var a,s=t.head||t.getElementsByTagName("head")[0];if("css"==e.substring(e.length-3))a=t.createElement("link"),a.rel="stylesheet",a.type="text/css",a.href=e;else{a=t.createElement("script"),a.type="text/javascript",a.async=!0,a.src=e;var r=!1;a.onload=a.onreadystatechange=a.onerror=function(){r||a.readyState&&!/loaded|complete/.test(a.readyState)||(r=!0,a.onload=a.onreadystatechange=null,h--,n&&n())},h++}s.appendChild(a)}function d(){var n=!1;if(o(t,function(){return n=!0,!0}),n){var a=e.mapBBCodeLoaderOptions,s=a.path||".";"/"!==s.substring(s.length-1)&&(s+="/"),a.mapBBCodeOptions.windowPath=s,l(s+"leaflet.css"),"ActiveXObject"in e&&!t.addEventListener&&l(s+"leaflet.ie.css"),l(s+"leaflet.js",function(){l(s+"mapbbcode.js",function(){var t,n=i(a.language,!0);if(n&&n.length>1&&l(s+"lang/"+n+".js"),a.proprietary.length>0||a.mapBBCodeOptions.layers)for(l(s+"LayerList.js"),t=0;t<a.proprietary.length;t++)l(s+"proprietary/"+i(a.proprietary[t])+".js");for(t=0;t<a.addons.length;t++)l(s+a.addons[t]);g=e.setInterval(p,100)})})}}function p(){if(!(h>0&&--m>0)){e.clearInterval(g);var t=e.mapBBCodeLoaderOptions;e.MapBBCodeProcessor.setOptions(t.processorOptions),e._mapBBCode=new e.MapBBCode(t.mapBBCodeOptions),e.updateMapBBCode()}}function c(n){o(n||t,function(t){var n=e._mapBBCode;if(t.button){var a=function(){n.editorWindow(t.target)};t.element.addEventListener?t.element.addEventListener("click",a):t.element.attachEvent("onclick",a)}else t.shared?n.showExternal(t.element,t.id):n.show(t.element)})}var g,h=0,m=50;e.updateMapBBCode=c,e.addEventListener?e.addEventListener("load",d,!1):e.attachEvent("onload",d)}(window,document);