window.mapBBCodeLoaderOptions = {
    path: "mapbbcode/",
    language: "",
    addons: [],
    proprietary: [],
    plain: false,
    force: false,
    mapBBCodeOptions: {},
    processorOptions: {}
};window.mapBBCodeLoaderOptions.set=function(e){for(var t in e)e.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(this[t]=e[t])},function(e,t){function n(e,n,a){var r,s,o,i=[],d=e||t,l=new RegExp("(?:^|\\s)"+n+"(?:\\s|$)");if(e.className&&l.test(e.className))return[e];if(d.getElementsByClassName)for(o=d.getElementsByClassName(n),r=0;r<o.length;r++)for(s=0;s<a.length;s++)o[r].nodeName==a[s]&&i.push(o[r]);else{for(o=[],r=0;r<a.length;r++)o=o.concat(d.getElementsByTagName(a[r]));for(r=0;r<o.length;r++)l.test(o[r].className)&&i.push(o[r])}return i}function a(e){var n=[];return function a(e){if(e.childNodes.length)for(var t=0;t<e.childNodes.length;t++)"tagName"in e&&"TEXTAREA"==e.tagName||"className"in e&&!(e.className.indexOf("mapbbcode")<0)||a(e.childNodes[t]);else e.nodeType==Node.TEXT_NODE&&(e.nodeValue.indexOf("[/map]")>=0||e.nodeValue.indexOf("[mapid]")>=0)&&n.push(e)}(e||t),n}function r(e,n,a,r){var s=t.createElement("div"),o=e.splitText(n),i=o.splitText(a);return s.className=r,o.parentNode.insertBefore(s,o),s.appendChild(o),i}function s(t){for(var n=new RegExp(e.MapBBCodeProcessor.getBBCodeRegExp().source,"gi"),a=new RegExp("\\[mapid\\]\\s*[a-z]+\\s*\\[/mapid\\]","gi"),s=0;s<t.length;s++)for(var o,i,d=t[s];;)if(o=n.exec(d.nodeValue),i=a.exec(d.nodeValue),o&&o.length>0)e.MapBBCodeProcessor.isEmpty(o[0])||(d=r(d,o.index,o[0].length,"mapbbcode"),n.lastIndex=0,a.lastIndex=0);else{if(!(i&&i.length>0))break;d=r(d,i.index,i[0].length,"mapbbcode_shared"),n.lastIndex=0,a.lastIndex=0}}function o(r,o){if(e.mapBBCodeLoaderOptions.plain){var i=a(r);i.length>0&&("MapBBCodeProcessor"in e?s(i):o.call(this,{}))}var d,l,p,c=n(r,"mapbbcode",["DIV"]);for(d=0;d<c.length;d++)if(l=c[d].childNodes,!(l&&l.length>0&&("DIV"==l[0].tagName||l.length>1&&"DIV"==l[1].tagName))&&(p=o.call(this,{shared:!1,element:c[d]})))return;for(c=n(r,"mapbbcode_shared",["DIV"]),d=0;d<c.length;d++)if(l=c[d].childNodes,!(l&&l.length>0&&("DIV"==l[0].tagName||l.length>1&&"DIV"==l[1].tagName))){var g=/^\s*(?:\[mapid\]\s*)?([a-z]+)(?:\s*\[\/mapid\])?\s*$/.exec(c[d].innerHTML);if(g&&g.length>1&&(p=o.call(this,{shared:!0,id:g[1],element:c[d]})))return}for(buttons=n(r,"mapbbcode_edit",["INPUT","BUTTON"]),d=0;d<buttons.length;d++){var h;if(buttons[d].getAttribute("target_id")&&(h=t.getElementsById(buttons[d].getAttribute("target_id"))),!h){var f=t.getElementsByTagName("TEXTAREA");f&&f.length>0&&(h=f[0])}if(p=o.call(this,{button:!0,target:h,element:buttons[d]}))return}}function i(e,t){if(!e||!e.length)return e;if(e=e.replace(/^\s+|\s+$/g,"").replace(/\.js$/,""),e.length<=1)return e.toUpperCase();if(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase(),t){var n=e.substring(0,2);"En"==n?e="English":"Ru"==n&&(e="Russian")}return e}function d(e,n){var a,r=t.head||t.getElementsByTagName("head")[0];if("css"==e.substring(e.length-3))a=t.createElement("link"),a.rel="stylesheet",a.type="text/css",a.href=e;else{a=t.createElement("script"),a.type="text/javascript",a.async=!0,a.src=e;var s=!1;a.onload=a.onreadystatechange=a.onerror=function(){s||a.readyState&&!/loaded|complete/.test(a.readyState)||(s=!0,a.onload=a.onreadystatechange=null,f--,n&&n())},f++}r.appendChild(a)}function l(){if(m||"MapBBCode"in e)return"updateMapBBCode"in e&&e.updateMapBBCode(),void 0;m=!0;var n=e.mapBBCodeLoaderOptions;if(!n.force){var a=!1;if(o(t,function(){return a=!0,!0}),!a)return}var r=n.path||".";"/"!==r.substring(r.length-1)&&(r+="/"),"windowPath"in n.mapBBCodeOptions||(n.mapBBCodeOptions.windowPath=r),d(r+"leaflet.css"),"ActiveXObject"in e&&!t.addEventListener&&d(r+"leaflet.ie.css"),d(r+"leaflet.js",function(){d(r+"mapbbcode.js",function(){var t,a=i(n.language,!0);if(a&&a.length>1&&d(r+"lang/"+a+".js"),n.proprietary.length>0||n.mapBBCodeOptions.layers)for(d(r+"LayerList.js"),t=0;t<n.proprietary.length;t++)d(r+"proprietary/"+i(n.proprietary[t])+".js");for(t=0;t<n.addons.length;t++)d(r+n.addons[t]);h=e.setInterval(g,50)})})}function p(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function c(n){o(n||t,function(t){var n=e._mapBBCode;t.button?p(t.element,"click",function(){n.editorWindow(t.target)}):t.shared?n.showExternal(t.element,t.id):n.show(t.element)})}function g(){if(!(f>0&&--u>0)){e.clearInterval(h);var t=e.mapBBCodeLoaderOptions;e.MapBBCodeProcessor.setOptions(t.processorOptions),e._mapBBCode=new e.MapBBCode(t.mapBBCodeOptions),e.updateMapBBCode=c,c()}}var h,f=0,u=60,m=!1;if("interactive"==t.readyState||"complete"==t.readyState)l();else if(t.addEventListener)t.addEventListener("DOMContentLoaded",l,!1);else{var B=function(){"interactive"!=t.readyState&&"complete"!=t.readyState?setTimeout(B,50):l()};B()}}(window,document);